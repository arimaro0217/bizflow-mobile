<!doctype html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#1f2937" />
  <meta name="description" content="中小企業向け資金繰り管理アプリ - スマホで爆速入力、キャッシュフロー即時可視化" />
  <meta name="robots" content="noindex, nofollow" />

  <!-- iOS PWA Configuration -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="GANTACT" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />



  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap"
    rel="stylesheet" />
  <title>GANTACT - 資金繰り管理</title>
</head>

<body>
  <div id="root"></div>
  <script>
    // === PWA Cache Buster v1.1.1 ===
    // 古いService Workerが居座っている場合に強制的にクリアする
    (function () {
      var APP_VERSION = '1.1.1';
      var STORED_VERSION = localStorage.getItem('app_version');

      if (STORED_VERSION !== APP_VERSION) {
        console.log('[CacheBuster] Version mismatch: stored=' + STORED_VERSION + ' current=' + APP_VERSION);
        localStorage.setItem('app_version', APP_VERSION);

        // 全てのService Workerを解除
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(function (registrations) {
            var promises = registrations.map(function (reg) {
              console.log('[CacheBuster] Unregistering SW:', reg.scope);
              return reg.unregister();
            });
            return Promise.all(promises);
          }).then(function () {
            // 全てのCacheStorageをクリア
            if ('caches' in window) {
              return caches.keys().then(function (names) {
                return Promise.all(names.map(function (name) {
                  console.log('[CacheBuster] Deleting cache:', name);
                  return caches.delete(name);
                }));
              });
            }
          }).then(function () {
            // 古いバージョンからの遷移時のみリロード（初回訪問は除く）
            if (STORED_VERSION !== null) {
              console.log('[CacheBuster] Reloading for fresh content...');
              window.location.reload();
            }
          });
        }
      }
    })();
  </script>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>